<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RBXM → Lua Converter</title>
<style>
:root{--bg1:#0f1724;--bg2:#1f2a44;--card:#0b1220;--accent:#7c5cff;--muted:#9aa4c0}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Helvetica,Arial;color:#e6eef8;background:linear-gradient(135deg,var(--bg1),#12213a);display:flex;align-items:center;justify-content:center;padding:28px}
.wrap{width:100%;max-width:980px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:14px;padding:22px;box-shadow:0 12px 40px rgba(2,6,23,0.6);display:grid;grid-template-columns:420px 1fr;gap:18px}
.header{grid-column:1 / -1;display:flex;align-items:center;gap:14px}
.logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#4aa3ff);display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:20px}
.title{line-height:1}
.title h1{font-size:18px;margin:0}
.title p{margin:0;color:var(--muted);font-size:13px;margin-top:4px}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.03);padding:16px;border-radius:12px;display:flex;flex-direction:column;gap:12px}
.input{display:flex;flex-direction:column;gap:8px}
.input input[type="text"]{padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;font-size:14px;outline:none}
.file-row{display:flex;gap:8px;align-items:center}
.file-btn{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:10px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.03);cursor:pointer}
.file-btn input{display:none}
.actions{display:flex;gap:8px}
.btn{flex:1;padding:12px;border-radius:10px;background:var(--accent);border:none;color:#fff;font-weight:600;cursor:pointer}
.btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}
.output-area{grid-column:2 / 3;display:flex;flex-direction:column;gap:12px}
textarea#output{width:100%;height:520px;padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);background:#071028;color:#dceeff;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-size:13px;resize:vertical;outline:none;line-height:1.45}
.footer{grid-column:1 / -1;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px;padding-top:6px}
.small{font-size:12px;color:var(--muted)}
.info{color:var(--muted);font-size:13px}
@media (max-width:900px){.wrap{grid-template-columns:1fr}.output-area{grid-column:1 / -1}textarea#output{height:340px}}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="logo">RBX</div>
    <div class="title">
      <h1>RBXM → Lua Converter</h1>
      <p>Paste an Asset ID or upload an RBXM/RBXMX. Generated Lua rebuilds instances in Studio.</p>
    </div>
  </div>

  <div class="card">
    <div class="input">
      <label class="small">Asset ID or URL</label>
      <input id="assetInput" type="text" placeholder="rbxassetid://123456 or https://www.roblox.com/library/123456/name">
    </div>

    <div class="input">
      <label class="small">Upload .rbxm / .rbxmx</label>
      <div class="file-row">
        <label class="file-btn" id="chooseFileBtn">Choose file
          <input id="fileInput" type="file" accept=".rbxm,.rbxmx">
        </label>
        <div class="info" id="fileName">no file chosen</div>
      </div>
    </div>

    <div class="actions">
      <button class="btn" id="convertAssetBtn">Convert Asset ID</button>
      <button class="btn secondary" id="convertRBXMBtn">Convert RBXM</button>
    </div>

    <div style="display:flex;gap:8px;margin-top:4px">
      <button class="btn secondary" id="clearBtn">Clear Output</button>
      <button class="btn" id="downloadBtn">Download Lua</button>
    </div>
  </div>

  <div class="output-area">
    <label class="small">Lua Output</label>
    <textarea id="output" spellcheck="false" readonly placeholder="Converted Lua will appear here"></textarea>
  </div>

  <div class="footer">
    <div class="small">Paste the generated code into ServerScriptService or the Command Bar in Roblox Studio</div>
    <div class="small" id="status">ready</div>
  </div>
</div>

<script>
const assetInput = document.getElementById('assetInput')
const fileInput = document.getElementById('fileInput')
const fileNameEl = document.getElementById('fileName')
const convertAssetBtn = document.getElementById('convertAssetBtn')
const convertRBXMBtn = document.getElementById('convertRBXMBtn')
const outputEl = document.getElementById('output')
const downloadBtn = document.getElementById('downloadBtn')
const clearBtn = document.getElementById('clearBtn')
const statusEl = document.getElementById('status')
let lastFilename = 'Converted.lua'

fileInput.addEventListener('change', ()=> {
  const f = fileInput.files[0]
  fileNameEl.textContent = f ? f.name : 'no file chosen'
})

function extractAssetId(text){
  if(!text) return null
  const m = text.match(/\d{5,}/)
  return m ? m[0] : null
}

function makeAssetLua(id){
  const safeId = id.toString().trim()
  const lines = []
  lines.push('local asset = game:GetObjects("rbxassetid://' + safeId + '")[1]')
  lines.push('if asset then')
  lines.push('  asset.Parent = workspace')
  lines.push('end')
  return lines.join('\n')
}

function downloadText(filename, text){
  try{
    const blob = new Blob([text], {type:'text/plain'})
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = filename
    document.body.appendChild(a)
    a.click()
    setTimeout(()=> {
      URL.revokeObjectURL(url)
      document.body.removeChild(a)
    }, 150)
    statusEl.textContent = 'downloaded'
  }catch(e){
    statusEl.textContent = 'download failed'
  }
}

function escapeLuaString(s){
  if(s.indexOf(']]') === -1){
    return '[[' + s + ']]'
  }else{
    return '"' + s.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\r/g,'').replace(/\n/g,'\\n') + '"'
  }
}

function sanitizeVar(name, id){
  name = String(name || 'Instance')
  name = name.replace(/[^\w]/g,'_')
  if(/^[0-9]/.test(name)) name = 'N' + name
  return name + '_' + id
}

function numText(n){
  if(isFinite(n)) return +n
  return 0
}

function parseVector3(node){
  const x = parseFloat(node.querySelector('X')?.textContent || node.querySelector('x')?.textContent || '0')
  const y = parseFloat(node.querySelector('Y')?.textContent || node.querySelector('y')?.textContent || '0')
  const z = parseFloat(node.querySelector('Z')?.textContent || node.querySelector('z')?.textContent || '0')
  return 'Vector3.new(' + x + ',' + y + ',' + z + ')'
}

function parseColor3(node){
  const r = parseFloat(node.querySelector('r')?.textContent || '0')
  const g = parseFloat(node.querySelector('g')?.textContent || '0')
  const b = parseFloat(node.querySelector('b')?.textContent || '0')
  return 'Color3.new(' + r + ',' + g + ',' + b + ')'
}

function parseProperties(item, varName, lines, className){
  const props = item.querySelectorAll(':scope > Properties > *')
  props.forEach(p=>{
    const propName = p.getAttribute('name') || p.getAttribute('key') || p.tagName
    const tag = p.tagName.toLowerCase()
    if(propName === 'Name') return
    if(tag === 'string'){
      const val = p.textContent || ''
      if(propName === 'Source' || className === 'Script' || className === 'LocalScript' || className === 'ModuleScript'){
        lines.push(varName + '.Source = ' + escapeLuaString(val))
      }else{
        lines.push(varName + '.' + propName + ' = ' + escapeLuaString(val))
      }
    }else if(tag === 'protectedstring'){
      const val = p.textContent || ''
      if(propName === 'Source' || className === 'Script' || className === 'LocalScript' || className === 'ModuleScript'){
        lines.push(varName + '.Source = ' + escapeLuaString(val))
      }else{
        lines.push(varName + '.' + propName + ' = ' + escapeLuaString(val))
      }
    }else if(tag === 'bool'){
      const v = String(p.textContent).trim().toLowerCase()
      lines.push(varName + '.' + propName + ' = ' + (v === 'true' ? 'true' : 'false'))
    }else if(tag === 'int' || tag === 'int32' || tag === 'int64' || tag === 'double' || tag === 'float' || tag === 'number'){
      const v = parseFloat(p.textContent || '0')
      lines.push(varName + '.' + propName + ' = ' + (isFinite(v) ? v : 0))
    }else if(tag === 'vector3'){
      lines.push(varName + '.' + propName + ' = ' + parseVector3(p))
    }else if(tag === 'color3'){
      lines.push(varName + '.' + propName + ' = ' + parseColor3(p))
    }else if(tag === 'brickcolor'){
      const txt = (p.textContent || '').trim()
      if(/^\d+$/.test(txt)){
        lines.push(varName + '.' + propName + ' = BrickColor.new(' + txt + ')')
      }else{
        lines.push(varName + '.' + propName + ' = BrickColor.new(' + escapeLuaString(txt) + ')')
      }
    }else{
    }
  })
}

function parseRBXMText(xmlText){
  const parser = new DOMParser()
  const doc = parser.parseFromString(xmlText, 'application/xml')
  const root = doc.documentElement || doc
  const topItems = []
  for(let i=0;i<root.childNodes.length;i++){
    const ch = root.childNodes[i]
    if(ch.nodeType === 1 && ch.tagName.toLowerCase() === 'item') topItems.push(ch)
  }
  let lines = []
  let idCounter = 0
  function parseItem(item, parentVar){
    idCounter++
    const className = item.getAttribute('class') || 'Model'
    const nameNode = item.querySelector(':scope > Properties > string[name="Name"], :scope > Properties > ProtectedString[name="Name"]')
    const displayName = (nameNode ? (nameNode.textContent || '') : className)
    const varName = sanitizeVar(displayName || className, idCounter)
    lines.push('local ' + varName + ' = Instance.new("' + className + '")')
    if(nameNode && (nameNode.textContent || '').trim() !== '') lines.push(varName + '.Name = ' + escapeLuaString(nameNode.textContent))
    if(parentVar) lines.push(varName + '.Parent = ' + parentVar)
    else lines.push(varName + '.Parent = workspace')
    parseProperties(item, varName, lines, className)
    const children = []
    for(let i=0;i<item.childNodes.length;i++){
      const ch = item.childNodes[i]
      if(ch.nodeType===1 && ch.tagName.toLowerCase() === 'item') children.push(ch)
    }
    children.forEach(c=>{
      parseItem(c, varName)
    })
    return varName
  }
  topItems.forEach(it=>{
    parseItem(it, null)
  })
  if(lines.length === 0) return ''
  return lines.join('\n')
}

convertAssetBtn.addEventListener('click', ()=>{
  statusEl.textContent = 'converting asset'
  const id = extractAssetId(assetInput.value)
  if(!id){
    statusEl.textContent = 'no valid asset id'
    return
  }
  const lua = makeAssetLua(id)
  outputEl.value = lua
  lastFilename = 'ConvertedFromAsset.lua'
  statusEl.textContent = 'ready'
})

convertRBXMBtn.addEventListener('click', ()=>{
  const f = fileInput.files[0]
  if(!f){
    statusEl.textContent = 'no file selected'
    return
  }
  const reader = new FileReader()
  reader.addEventListener('load', (e)=>{
    try{
      const text = e.target.result
      const lua = parseRBXMText(text)
      if(!lua || lua.trim() === ''){
        statusEl.textContent = 'no items parsed'
        outputEl.value = ''
        return
      }
      outputEl.value = lua
      lastFilename = (f.name.replace(/\.[^.]+$/,'') || 'Converted') + '.lua'
      statusEl.textContent = 'ready'
    }catch(err){
      outputEl.value = ''
      statusEl.textContent = 'parse error'
    }
  })
  reader.readAsText(f)
})

downloadBtn.addEventListener('click', ()=>{
  const txt = outputEl.value || ''
  if(!txt.trim()){
    statusEl.textContent = 'nothing to download'
    return
  }
  downloadText(lastFilename, txt)
})

clearBtn.addEventListener('click', ()=>{
  outputEl.value = ''
  statusEl.textContent = 'cleared'
})
</script>
</body>
</html>    }
  </script>
</body>
</html>
